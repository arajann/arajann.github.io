---
title: "Plots"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source: embed
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(p8105.datasets)
library(skimr)
library(plotly)
library(dplyr)
```

Column {data-width=650}
-----------------------------------------------------------------------

```{r warning = FALSE, include = FALSE}
data ("rest_inspec")

inspec_df =
  rest_inspec %>% 
  filter(
    boro == "MANHATTAN",
  ) %>% 
  distinct(dba,inspection_date, .keep_all= TRUE) %>% 
  drop_na(score)

```


### Number of Critical Violations over Time


```{r warning = FALSE}
inspec_df %>% 
  separate(col = inspection_date, into = c("year", "month", "day"), sep ="-", remove = TRUE, convert = TRUE, extra = 'warn',fill='warn') %>% 
    mutate(
    month = 
      recode(month, 
             "1" = "January", "2" = "February",
             "3" = "March", "4" = "April",
             "5" = "May", "6" = "June",
             "7" = "July", "8" = "August",
             "9" = "September", "10" = "October",
             "11" = "November", "12" = "December")) %>%
  filter(
    critical_flag == "Critical") %>% 
  group_by(month,year) %>% 
  count(critical_flag) %>% 
  plot_ly(x=~month, y=~n, group=~year, color = ~year, type="scatter", mode="lines+markers") 
```

Column {data-width=350}
-----------------------------------------------------------------------

### Comparing Total Scores of Critical vs Not Critical

```{r warning= FALSE}
inspec_df %>%
  filter(
    critical_flag %in% c("Critical","Not Critical")) %>% 
  plot_ly(y= ~score, color = ~critical_flag, type= "box", colors="viridis") 
```

Column {data-width=350}
-----------------------------------------------------------------------

### Frequency of Each Violation Code


```{r warning=FALSE}
inspec_df %>% 
  count(violation_code) %>% 
  mutate(violation_code = fct_reorder(violation_code,n)) %>% 
  plot_ly(x= ~violation_code, y=~n,color= ~violation_code, type= "bar", colors="viridis")
```

